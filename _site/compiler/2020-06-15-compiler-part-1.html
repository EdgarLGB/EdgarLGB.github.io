<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Compiler part 1 - Your awesome title</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Compiler part 1 | Your awesome title</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Compiler part 1" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <link rel="canonical" href="http://localhost:4000/compiler/2020-06-15-compiler-part-1.html" /> <meta property="og:url" content="http://localhost:4000/compiler/2020-06-15-compiler-part-1.html" /> <meta property="og:site_name" content="Your awesome title" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Compiler part 1" /> <script type="application/ld+json"> {"@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/selfie.jpg"}},"url":"http://localhost:4000/compiler/2020-06-15-compiler-part-1.html","headline":"Compiler part 1","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/gsoc/" class="nav-list-link">Google Summer of Code</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/gsoc/2018-8-9-Gsoc-project.html" class="nav-list-link">Summary of GSOC 2018 project</a></li><li class="nav-list-item "><a href="http://localhost:4000/gsoc/2018-6-12-Three-lessons-for-me.html" class="nav-list-link">Three lessons learnt from GSOC (First evaluation)</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/parameter_server/" class="nav-list-link">Parameter Server</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/parameter_server/2020-07-19-parameter-server.html" class="nav-list-link">Parameter server part 1</a></li><li class="nav-list-item "><a href="http://localhost:4000/parameter_server/2018-4-30-Gradient-descent.html" class="nav-list-link">Gradient descents in machine learning</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/compiler/" class="nav-list-link">Compiler</a><ul class="nav-list "><li class="nav-list-item active"><a href="http://localhost:4000/compiler/2020-06-15-compiler-part-1.html" class="nav-list-link active">Compiler part 1</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/flink/" class="nav-list-link">Flink</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/flink/2021-02-07-flink-learned-1.html" class="nav-list-link">What I learned from a crash of a Yarn application</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/git/" class="nav-list-link">Git</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/git/2018-4-13-Difference-tag-branch.html" class="nav-list-link">Difference between tag and branch</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/resume/" class="nav-list-link">Resume</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Your awesome title" aria-label="Search Your awesome title" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/EdgarLGB" class="site-button" > Github </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/compiler/">Compiler</a></li> <li class="breadcrumb-nav-list-item"><span>Compiler part 1</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2 id="whats-up"> <a href="#whats-up" class="anchor-heading" aria-labelledby="whats-up"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What’s up? </h2> <p>I hope everyone stays safe. 2020 is not a usual year when everything seems stuck. I have been locked down at home for more than three months meaning no need to spend time going back and forth between home and the office which is good. So I tried to learn something interesting during this time. What inspired me is the work I did in Apache SystemML during <a href="http://edgarlgb.github.io/Gsoc-project/">GSoC 2018</a>. The work was that I implemented a built-in function from compilation to runtime. So I would like to know how does a program work under-the-hood.</p> <h2 id="how-a-program-works"> <a href="#how-a-program-works" class="anchor-heading" aria-labelledby="how-a-program-works"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How a program works? </h2> <p>A program is merely a text file but how do we make the computer understand what it is asked to do. Nowadays, we usually write a program in a high-level programming language for example Java which is only understandable to human. And the computer only understands the machinery code. We also have some prepared instruction sets which allow to order the computer to do what you want. But we are not writing the program using that complex low-level instructions (which sounds impossible to write an app using it), then how do we translate the high-level programming language to those instructions? We need a compiler. A compiler is a system to translate a high-level programming language into a low-level one such as the intermediate instructions. While an interpreter is a system to execute the instructions upon an operating system. Take Java as an example, javac is a compiler which translates the class files into object byte codes and then the JVM (Java Virtual Machine) will read those intermediate instructions and execute it. It is not surprising that people sometimes call the interpreter a virtual machine. In this tutorial, I will only focus on the compiler.</p> <h2 id="architecture"> <a href="#architecture" class="anchor-heading" aria-labelledby="architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Architecture </h2> <p>In general, the architecture of a compiler consists of two parts: frontend and backend. The frontend is a process of turning a stream of characters into a set of intermediates including lexer, syntax analysis, semantic analysis, generation of intermediates. The backend refers to the runtime, the execution part.</p> <h2 id="what-is-the-task-of-tokenization"> <a href="#what-is-the-task-of-tokenization" class="anchor-heading" aria-labelledby="what-is-the-task-of-tokenization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What is the task of tokenization? </h2> <p>The task is to read a stream of characters and generate a stream of tokens. A token is the minimum unit of a language which can’t be split up, for example, an integer, a keyword.</p> <h2 id="implementation-of-tokenization"> <a href="#implementation-of-tokenization" class="anchor-heading" aria-labelledby="implementation-of-tokenization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implementation of tokenization </h2> <p>The idea is very straightforward. It takes an input of a stream of characters and outputs a stream of tokens. The key point of the implementation is how to determine the token based on the current character. That means when it meets an alphabet, it can uniquely decide this is going to be an identifier (keyword is also an identifier). When it reads a digit, it can determine this is going to be a number . So I cite some of the rules defined in our language using regular expression: (the left part infers the right parts)</p> <ul> <li>number -&gt; Integer optionalPoint optionalFraction</li> <li>Integer -&gt; ([0-9])+</li> <li> <div class="table-wrapper"><table> <tbody> <tr> <td>optionalPoint -&gt; .</td> <td>e (empty)</td> </tr> </tbody> </table></div> </li> <li>optionalFraction -&gt; ([0-9])+</li> <li> <div class="table-wrapper"><table> <tbody> <tr> <td>identifier -&gt; ([a-Z])([a-Z]</td> <td>[0-9])*</td> </tr> </tbody> </table></div> </li> <li> <div class="table-wrapper"><table> <tbody> <tr> <td>relationOperator -&gt; &gt;</td> <td>&lt;</td> <td>&gt;=</td> <td>&lt;=</td> <td>==</td> <td>!=</td> </tr> </tbody> </table></div> </li> <li> <div class="table-wrapper"><table> <tbody> <tr> <td>operator -&gt; +</td> <td>-</td> <td>*</td> <td>/</td> <td>%</td> </tr> </tbody> </table></div> </li> </ul> <h3 id="read"> <a href="#read" class="anchor-heading" aria-labelledby="read"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Read </h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lexer</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">InputStream</span> <span class="n">inputStream</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">char</span> <span class="nf">getChar</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div> <h3 id="scan-an-identifier"> <a href="#scan-an-identifier" class="anchor-heading" aria-labelledby="scan-an-identifier"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scan an identifier </h3> <p>Here is an example showing how to grab an identifier token. A valid identifier includes either alphabets or digits but always starts with an alphabet. The idea is to read the characters one by one from the input stream and to see it starts with an alphabet, if so that means we meet an identifier. And then we continue to read the characters until we encounter a character which is neither alphabet nor digit. As you look into the code, you might wonder what is a lexeme. A lexeme is like a word of a language which shows exactly what characters is this token made of. Another question is that we want to create a token only once even if we met the same lexeme more than once. We can create an identifier table to keep all the deja-vu identifiers. And then you might ask how do we differentiate an identifier from a keyword given that they are all made of either characters or digits? In fact, a keyword is a token that we preserve to be used internally by the language meaning the users can’t define an identifier with the same lexeme of a keyword. We can’t define <strong>true</strong> as an identifier since it has been preserved to be a keyword. To know if the current token is a keyword, we previously insert the keyword tokens into <strong>identifierMap</strong> which is a map of <em>lexeme</em> =&gt; <em>token</em>. When we have a lexeme, we look it up in this map to see if there is a corresponding token.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lexer</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">InputStream</span> <span class="n">inputStream</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">char</span> <span class="n">current</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Identifier</span><span class="o">&gt;</span> <span class="n">identifierMap</span><span class="o">;</span>  <span class="c1">// the mapping of lexeme -&gt; &lt;tag, lexeme&gt;</span>

    <span class="kd">public</span> <span class="nf">Lexer</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">inputStream</span> <span class="o">=</span> <span class="n">input</span><span class="o">;</span>
        <span class="n">current</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="o">;</span>
        <span class="n">lookahead</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="o">;</span>
        <span class="n">identifierMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">addKeywords</span><span class="o">(</span><span class="n">identifierMap</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addKeywords</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Identifier</span><span class="o">&gt;</span> <span class="n">identifierMap</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">identifierMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"true"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Identifier</span><span class="o">(</span><span class="nc">Tags</span><span class="o">.</span><span class="na">TRUE</span><span class="o">,</span> <span class="s">"true"</span><span class="o">));</span>
        <span class="n">identifierMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"false"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Identifier</span><span class="o">(</span><span class="nc">Tags</span><span class="o">.</span><span class="na">FALSE</span><span class="o">,</span> <span class="s">"false"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">char</span> <span class="nf">getChar</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="nc">Token</span> <span class="nf">scan</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Token</span> <span class="n">res</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isCharacter</span><span class="o">(</span><span class="n">current</span><span class="o">))</span> <span class="o">{</span>  <span class="c1">// read identifier token (variables, keywords)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">scanIdentifier</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Token</span> <span class="nf">scanIdentifier</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="k">do</span> <span class="o">{</span>  <span class="c1">// Currently only support the identifiers made of characters and digits (but always starts with character)</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">current</span><span class="o">);</span>
            <span class="n">match</span><span class="o">(</span><span class="n">current</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">isCharacter</span><span class="o">(</span><span class="n">current</span><span class="o">)</span> <span class="o">||</span> <span class="n">isDigit</span><span class="o">(</span><span class="n">current</span><span class="o">));</span>
        <span class="n">register</span> <span class="o">=</span> <span class="n">current</span><span class="o">;</span>

        <span class="nc">String</span> <span class="n">lexeme</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="nc">Identifier</span> <span class="n">id</span> <span class="o">=</span> <span class="n">identifierMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">lexeme</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">id</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Identifier</span><span class="o">(</span><span class="nc">Tags</span><span class="o">.</span><span class="na">ID</span><span class="o">,</span> <span class="n">lexeme</span><span class="o">);</span>
            <span class="n">identifierMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">lexeme</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="next-part"> <a href="#next-part" class="anchor-heading" aria-labelledby="next-part"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next part </h2> <p>In the next part, I will talk about the grammar of a language, such as the context, terminators, rules, etc.</p> <hr> <footer> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
